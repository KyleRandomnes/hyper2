---
title: "cooking"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Suppose there are five people in a family.  Each day for five days,
one person cooks a meal.  After the fifth day, each person puts the
meals in order of preference, but is not allowed to vote on their own
meal.  This very short vignette shows how to apply generalized
Bradley-Terry to this situation using the `hyper2` package.

```{r cars}
library(hyper2)
H <- hyper2(pnames=paste("p",1:5,sep=""))
H
```

Now add some data:

```{r}
H <- H +
    order_likelihood(c(5,2,3,4)) + # person 1 says 5 is the best, 4 the worst.
    order_likelihood(c(1,5,3,4)) + # person 2 says 1 is the best, 4 the worst.
    order_likelihood(c(1,4,2,5)) + # person 3 says 1 is the best, 5 the worst.
    order_likelihood(c(1,2,3,5)) + # person 4 says 1 is the best, 5 the worst.
    order_likelihood(c(2,1,3,4))   # person 5 says 2 is the best, 4 the worst.
H
```

Note that noone is allowed to vote for themselves.  We may find
maximum likelihood estimate for the strengths,
$\operatorname{argmax}\mathcal{L}\left(p_1,\ldots,p_5\right)$:

```{r}
maxp(H)
```

Graphically:

```{r maxlike, echo=FALSE}
dotchart(maxp(H),main="probabilities")
dotchart(log(maxp(H)),main="log probabilities")
```

We can assess the hypothesis that all players have the same strength:

```{r} 
L1 <- loglik(H,indep(equalp(H)))  # support at equal strengths
L2 <- loglik(H,indep(maxp(H)))    # maximum support
L2-L1
pchisq(2*(L2-L1),df=1,lower.tail=FALSE) # p-value of asymptotic distribution
```

Now we can assess the hypothesis that person `a` does in fact have the
highest strength of the five.  We can follow the reasoning in the
_icons_ demonstration:

```{r}
o <- function(Ul,Cl,startp,give=FALSE){
    small <- 1e-5  #  ensure start at an interior point
    if(missing(startp)){startp <- small*(1:4)+rep(0.1,4)}
    out <- maxp(H, startp=small*(1:4)+rep(0.1,4), give=TRUE, fcm=Ul,fcv=Cl)
		if(give){
			return(out)
		} else {
			return(out$value)
		}
}

p2max <- o(c(-1, 1, 0, 0), 0)
p3max <- o(c(-1, 0, 1, 0), 0)
p4max <- o(c(-1, 0, 0, 1), 0)
p5max <- o(c(-2,-1,-1,-1),-1)
```

(the final line is different because `p5` is the fillup value).

```{r}
(likes <- c(p2max,p3max,p4max,p5max))
max(likes)
```

Observe that the hypothesis with the maximum likelihood is
$p_2\geqslant p_1$, as might be expected on the grounds that in the
unconstrained case we have
$\hat{p_2}>\max\left(\hat{p_3},\hat{p_4},\hat{p_5}\right)$.  Now
compare the constrained maximum with the unconstrained maximum:

```{r}
maxp(H,give=TRUE)$value
```

So the support loss by the constraint is

```{r}
(L <- maxp(H,give=TRUE)$value - max(likes))
```

short of Edwards's two-units-of-support criterion.  There is no strong
evidence to support the assertion that person 1 is actually stronger
than person 2 in the sense that $p_1>p_2$.