title: "Ladies' figure skating"
author: "Robin K. S. Hankin"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{figure_skating}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Ladies' figure skating in the 2002 Winter Olympics

This script creates and analyses hyper2 object "skating" which is a
likelihood function for the strengths of the competitors in the
Ladies' Figure Skating at the 2002 Winter Olympics.  Dataframe
`skating_table` is copied from Lock and Lock (see skating.Rd for
more details).

```{r}
library("hyper2",quietly=TRUE)
set.seed(0)
data("skating")
skating_table
```		

Object `skating_table` is structured so that each competitor is a
row, and each judge is a column.  Function `rank_likelihood()`
considers each row to be a race [or a judge], so we need to take a
transpose.  The following R idiom is plausible but incorrect:


```{r}
skating_incorrect <- rank_likelihood(t(skating_table))
```

The above is incorrect because we want the ranks, and we have the
order.  Correct analysis follows.


```{r}
skating_rank <- apply(skating_table,2,order)
head(skating_rank)
```

Column 1 of `skating_table` and column 1 of `skating_rank` are
confusingly simular.  So consider column 2 instead, corresponding to
judge number 2.  If `a=skating_table[,2]` and
`b=skating_rank[,2]` we have `a=c(4,1,3,2, ...)` and
`b=c(2,4,3,1, ...)`.  Thus `a` means that hughes was judged to
be fourth best, slutskaya was judged to be the best, kwan third best,
cohen second best, and so on.  Conversely, `b` means that the best
competitor was number two [slutskaya], the second best number was
number four [cohen], the third best was number three [kwan], the
fourth best number 1 [hughes], and so on.  _Note that this means the
rows of `skating_rank` cannot be named_.


```{r}
skating <- rank_likelihood(t(skating_rank))
pnames(skating) <- rownames(skating_table)
head(skating)
```

Further, we might ask how many judges ranked each competitor first,
second and so on:

```{r,alljudgeorder}
oo <- sapply(seq_len(23),function(i){rowSums(skating_table==i)})
colnames(oo) <- rep(" ",23)  # nicer print
oo
```

In the above, each row is a competitor and each column corresponds to
a ranking.  Thus the first column corresponds to "first place" and
	shows that five judges ranked Hughes first and four judges ranked
Slutskaya first.  The second column corresponds to "second place" and
shows that one judge gave Hughes second place, two judges placed
Slutskaya second, five gave Kawn second, and one gave Cohen second.
The formal ordering is, I think, to rank the competitors by number of
first places, then second, then third , and so on.  Ties at level $n$
are broken by considering $n+1$.


# Data visualization

Now some data visualization.  First the MLE for the strengths:

```{r,maxshow}
(m <- maxp(skating))
```

```{r,dpi=72}
dotchart(m)
dotchart(log(m))
```



## Evidence for medal positions

Looking at the dotcharts, it seems that the medallists---Hughes (gold),
Slutskya (silver), Kwan (bronze)---were considerably higher in
strength than the rest of the field.  Here I will test the hypothesis
that the medallists were in fact the strongest three competitors.
Technically you need to optimize over the union of the possibilities
that one of the three medallists did not come in the top three; but
this is hard.  We will do something much easier but numerically
equivalent: optimize over the union of outcomes where either Cohen or
Suguri (who placed fourth and fifth respectively) had higher strength
than any of the medallists.

```{r}
jj <-
    matrix(c(
        -1, 0, 0,   1,0,  # Hughes   < Cohen
         0,-1, 0,   1,0,  # Slutskya < Cohen
         0, 0,-1,   1,0,  # Kwan     < Cohen
        
        -1, 0, 0,   0,1,  # Hughes   < Suguri
         0,-1, 0,   0,1,  # Slutskya < Suguri
         0, 0,-1,   0,1), # Kwan     < Suguri
        byrow=TRUE,ncol=5)

problem_constraints <-  # fill with zeros for other competitors
    cbind(jj,matrix(0,nrow(jj),size(skating)-ncol(jj)-1))

small <- 1e-6  # need a sensible start value satisfying the constraints
start <- c(rep(2*small,3),rep(3*small,2),rep(small,17))

out <- rep(0,nrow(problem_constraints))
fullout <- list()

for(i in seq_len(nrow(problem_constraints))){
jj <- maxp(skating, startp=start, give=TRUE,fcm=problem_constraints[i,], fcv=0)
   fullout[[i]] <- jj
   out[i] <- jj$value
}
out
```

Now compare these values with the unconstrained maximum likelihoods:

```{r,unconstrainedlikes}
mgv <- maxp(skating,give=TRUE)$value
mgv  - out
mgv  - max(out)
```

that is, a little over 1 unit of support, falling short of the two
units suggested by Edwards.  Observe that the maximum likelihood among
the six alternative hypotheses is that of number 3, in which the
maximization was constrained to obey `Kwan < Cohen`.

If, instead, we ask whether there is evidence that Suguri should not
have been a medallist, we find

```{r}
mgv  - max(out[4:6])
```

We can be more specific with the likelihoods:

```{r}
plot(out,ylab="log likelihood",axes=FALSE)
axis(2)
axis(side=1,at=1:6,srt=45,labels=c(
"Hug<Coh", "Slu<Coh", "Kwa<Coh",
"Hug<Sug", "Slu<Sug", "Kwa<Sug"
))
```

In the plot above, the vertical axis shows the support.  The six
points on the x-axis correspond to the six rows of
`problem_constraints`; names have been abbreviated to the first three
letters.  Thus the first three points are maximum likelihoods for
`Hughes < Cohen`, `Slutskya < Cohen`, and `Kwan < Cohen` respectively.

## Ranking methodologies.

 maximum likelihood estimated strengths furnish an ordering for the competitors.
We can compare ranking by strengths with the official point-tallying method:

```{r,dpi=72}
par(pty='s')
lik <- rank(-m)
plot(1:23,lik,asp=1,pch=16,xlab='official order',ylab='likelihood order')
text(1:23,lik,asp=1,pch=16,pos=c(rep(4,19),rep(2,4)),rownames(skating_table))
abline(0,1)
```

In the above diagram, there is close agreement between the two methods
in the large, but differences in detail.  For example, the official
ordering is hughes first, then slutskaya second, then kwan third;
likelihood winner is slutskya, followed by hughes and then kwan.

We can gain some understanding of this result by looking at the raw
judging results for the three medallists:

```{r,threemedallists}
head(skating_table,2)
```

and then calculating a table of the results:

```{r, tableofresults}
hughes    <- unlist(skating_table[1,])
slutskaya <- unlist(skating_table[2,])
table(hughes)
table(slutskaya)
```

Looking at the above, we see that Hughes has five judges who gave her
"1"s, while Slutskaya has only 4, which is why she was considered to
be the top.  It seems that Hughes's two "4"s (compared with
Slutskaya's one) have cost her more likelihood-based strength than her
extra "1" gave her; note also that the two judges who placed Highes
fourth (viz `J2` and `J4`) placed Slutskaya first.  Also:

```{r,compareslutskayahughes}
table(hughes < slutskaya)
```

(note that equality is disallowed) showing that five judges preferred Hughes
to Slutskaya and four preferred Slutsakaya to Hughes.

