---
title: "Judging domestic cooking ability: repeated incomplete rank observations"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Suppose there are five people in a family.  Each day for five days,
one person cooks a meal.  After the fifth day, each person considers
the four meals cooked by other family members, and puts them in order
of preference.  This process is repeated and here I consider how to
interpret such data.

```{r loadlib,echo=FALSE}
library(hyper2,quietly=TRUE)
```


```{r data}
cooking_table <- as.matrix(read.table("cooking_weekly.txt", header=TRUE))
head(cooking_table)
```
Thus from the first row we find that one judge considered Lesley to be
fourth best, Alice third, Zac second and Annabel best (this must have
been Robin: no-one is allowed to vote for themselves and a zero means
no vote).  This is the transpose of an order table such as
`skating.txt`.  In this context a zero contains no information (unlike
the formula 1 tables in which zeros signify did not finish).  Document
`curling.Rmd` contains a discussion and here we will use the same
method.  First we will consider the support function for the first row only:

### First row of the dataset

```{r}
jj <- cooking_table[1,]
H_row1 <- order_obs(hyper2(pnames=colnames(cooking_table)),jj[jj>0])
H_row1
```

In the above, we calculate the Plackett-Luce likelihood function;
observe that it is uninformative about competitor number 1, which I
show in two ways.  Firstly:

```{r}
p1 <- rdirichlet(1,dirichlet(rep(10,5)))
# Now create p2 which is the same but competitor 1 is stronger:
p2 <- p1
p2[1] <- p2[1] + 0.1     # person 1 becomes stronger...
p2[-1] <- p2[-1] - 0.1/4 # ...and everyone else becomes weaker

loglik(indep(p1),H_row1)
loglik(indep(p2),H_row1)
```

but more generally:

```{r}
(p <- rdirichlet(1,dirichlet(rep(1,5))))
evaluate(brackets(H_row1), powers(H_row1), probs=p)
evaluate(brackets(H_row1), powers(H_row1), probs=p*4)
```

## Complete dataset

It is easy to iterate over the rows of the dataset:

```{r}
H <- hyper2(pnames=colnames(cooking_table))

for(i in seq_len(nrow(cooking_table))){  # iterate over rows
    x <- cooking_table[i,] 
    names(x) <- colnames(cooking_table)
    H %<>% order_obs(x[x>0])
}
H
```

(compare file `curling.Rmd` in which we iterate over columns not rows).
Standard techniques may be used:


```{r}
pie(maxp(H))
equalp.test(H)
```


